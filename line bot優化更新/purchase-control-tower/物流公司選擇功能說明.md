# 物流公司選擇功能使用說明

## 🎯 功能說明

系統現在支援兩家物流公司的查詢連結自動生成：
- **順豐速運**（SF Express）
- **Score 物流**（DEC Logistics）

當您發送 LINE 通知時，系統會根據您選擇的物流公司，自動生成對應的查詢連結並帶入追蹤號碼，客戶點開連結就能直接查看物流狀態。

---

## 📊 新增欄位：Courier

### 欄位位置
- **工作表**：Queue
- **欄位**：X 欄（第 24 欄）
- **名稱**：Courier
- **資料類型**：文字（SF 或 SCORE）

### 欄位值
- `SF` - 順豐速運
- `SCORE` - Score 物流
- 留空 - 使用預設（順豐）

---

## 🚀 使用方式

### 方法 1：在 Queue 表直接填寫

1. 開啟 Google Sheets → Queue 表
2. 找到要設定的商品行
3. 在 **X 欄（Courier）** 填入：
   - `SF` → 順豐速運
   - `SCORE` → Score 物流
4. 其他步驟照常（填寫追蹤碼、勾選 ReadyToNotify）

### 方法 2：在通知管理介面選擇（推薦）⭐

1. **準備資料**：
   - 在 Queue 表填寫追蹤碼
   - 勾選 ReadyToNotify = TRUE

2. **開啟通知管理**：
   - Web App → 點選「🔔 通知管理」
   - 系統自動顯示所有待發送通知

3. **選擇物流公司**：
   - 每個通知卡片都有「📦 選擇物流公司」下拉選單
   - 包含選項：順豐速運、Score 物流
   - 選擇後點選「更新」按鈕

4. **預覽訊息**：
   - 選擇物流公司後，訊息預覽會即時更新
   - 顯示對應的物流公司名稱
   - 顯示對應的查詢連結

5. **確認發送**：
   - 確認訊息內容無誤
   - 點選「✅ 確認發送」

---

## 🌐 物流查詢 URL 格式

### 順豐速運（SF）
```
https://htm.sf-express.com/hk/tc/dynamic_function/waybill/#search/bill-number/【追蹤號碼】
```

**範例**：
- 追蹤號碼：`SF1234567890`
- 生成連結：`https://htm.sf-express.com/hk/tc/dynamic_function/waybill/#search/bill-number/SF1234567890`

### Score 物流（SCORE）
```
https://declogistics.com.tw/h/DataDetail?key=amqeg&cont=【追蹤號碼】
```

**範例**：
- 追蹤號碼：`250398`
- 生成連結：`https://declogistics.com.tw/h/DataDetail?key=amqeg&cont=250398`

---

## 📱 LINE 訊息格式

選擇不同物流公司後，LINE 推播訊息會自動調整：

### 範例：順豐速運
```
🚢 您的訂單 #ES5336 中的商品已從日本寄出

📦 物流公司：順豐速運
📦 追蹤碼：SF1234567890

🔍 點此查看物流狀態：
https://htm.sf-express.com/hk/tc/dynamic_function/waybill/#search/bill-number/SF1234567890

感謝您的耐心等候！
```

### 範例：Score 物流
```
🚢 您的訂單 #ES5401 中的商品已從日本寄出

📦 物流公司：Score 物流
📦 追蹤碼：250398

🔍 點此查看物流狀態：
https://declogistics.com.tw/h/DataDetail?key=amqeg&cont=250398

感謝您的耐心等候！
```

---

## 💡 實際操作範例

### 情境：訂單 ES5336 使用順豐寄送

**方法 A：Queue 表操作**
1. 在 Queue 表找到訂單 ES5336 的行
2. 填入：
   - `S 欄（Tracking_JP_to_TW）` = `SF1234567890`
   - `X 欄（Courier）` = `SF`
   - `W 欄（ReadyToNotify）` = `TRUE`
3. 等待系統自動推播

**方法 B：通知管理介面（推薦）**
1. 在 Queue 表填入：
   - 追蹤碼 = `SF1234567890`
   - ReadyToNotify = `TRUE`
2. 開啟「通知管理」頁面
3. 找到訂單 ES5336 的卡片
4. 在下拉選單選擇「順豐速運」
5. 點選「更新」按鈕
6. 檢查訊息預覽（應該顯示順豐的查詢連結）
7. 點選「✅ 確認發送」

---

## 🔄 修改物流公司

如果發現選錯物流公司，可以：

1. **發送前修改**：
   - 在通知管理頁面直接更改下拉選單選項
   - 點選「更新」
   - 訊息預覽會即時更新

2. **發送後修改**（如需重發）：
   - 回到 Queue 表
   - 修改 `Courier` 欄位
   - 將 `Notify_Pushed_Flag` 改為 FALSE
   - 將 `ReadyToNotify` 改為 TRUE
   - 重新發送

---

## ⚙️ 進階設定

### 新增其他物流公司

如果未來需要新增第三家物流公司，請修改：

**1. Config.gs**
```javascript
const COURIER_TYPES = {
  SF: 'SF',
  SCORE: 'SCORE',
  NEWCOURIER: 'NEWCOURIER'  // 新增
};

const COURIER_NAMES = {
  SF: '順豐速運',
  SCORE: 'Score 物流',
  NEWCOURIER: '新物流公司名稱'  // 新增
};

const COURIER_TRACKING_URLS = {
  SF: 'https://...',
  SCORE: 'https://...',
  NEWCOURIER: 'https://...?tracking={{tracking}}'  // 新增
};
```

**2. notification-manager.html**
```html
<select id="courier_${index}">
  <option value="">-- 請選擇 --</option>
  <option value="SF">順豐速運</option>
  <option value="SCORE">Score 物流</option>
  <option value="NEWCOURIER">新物流公司名稱</option>  <!-- 新增 -->
</select>
```

---

## ⚠️ 注意事項

1. **追蹤號碼格式**：
   - 順豐：通常以 SF 開頭，12-14 位
   - Score：純數字，6-8 位
   - 請確認填入正確格式

2. **物流公司選擇**：
   - 發送前務必確認選擇正確的物流公司
   - 訊息預覽會顯示實際發送的連結
   - 建議先用自己的 LINE 測試

3. **必選欄位**：
   - 如果沒有選擇物流公司，系統會使用預設（順豐）
   - 建議每次都明確選擇

4. **訊息預覽**：
   - 選擇物流公司後，訊息預覽會即時更新
   - 可以直接複製預覽中的連結測試是否正確

---

## 📋 檢查清單

發送通知前請確認：

- [ ] 追蹤號碼已填入（Tracking_JP_to_TW）
- [ ] 物流公司已選擇（Courier）
- [ ] 物流公司與追蹤號碼相符（例如順豐追蹤號用順豐）
- [ ] 訊息預覽顯示正確的物流公司名稱
- [ ] 訊息預覽顯示正確的查詢連結
- [ ] LINE User ID 正確（OrderLineUserMap 中有對應）
- [ ] ReadyToNotify 已勾選為 TRUE

---

## ✅ 完整流程範例

### 訂單 ES5336 - 順豐寄送

1. **在 Queue 表準備資料**：
   ```
   ES_Order_No: ES5336
   Product_Name: Nike T恤
   Tracking_JP_to_TW: SF1234567890
   Courier: SF
   ```

2. **勾選 ReadyToNotify = TRUE**

3. **開啟通知管理頁面**

4. **確認訊息預覽**：
   ```
   📦 物流公司：順豐速運
   🔍 點此查看物流狀態：
   https://htm.sf-express.com/hk/tc/dynamic_function/waybill/#search/bill-number/SF1234567890
   ```

5. **點選「✅ 確認發送」**

6. **客戶收到 LINE 通知，點開連結直接查看物流**

---

**祝您使用順利！** 🎉

有任何問題歡迎詢問。
