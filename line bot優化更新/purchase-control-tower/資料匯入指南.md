# 現有系統資料匯入指南

## 📋 概述

此指南幫助您將現有「LINE OA系統後端」的資料匯入到新的「採購控制塔系統」。

**重要**：匯入前請先完成新系統的安裝與初始化。

---

## 🎯 需要匯入的資料

### 1. 訂單與 LINE User ID 對照（必要）

**來源表**：您現有系統中儲存會員綁定的工作表

**目標表**：`OrderLineUserMap`

**欄位對照**：

| 現有欄位 | 新系統欄位 | 說明 |
|---------|-----------|------|
| 訂單編號 | ES_Order_No | EasyStore 訂單編號 |
| LINE User ID | LINE_User_ID | LINE 使用者 ID |
| 客戶名稱（選填） | Customer_Name | 客戶姓名 |
| LINE 顯示名稱（選填） | LINE_Display_Name | LINE 顯示名稱 |

**操作步驟**：

1. 開啟現有的 Google Sheets
2. 複製會員綁定資料（包含訂單編號與 LINE User ID）
3. 開啟新系統的 Google Sheets
4. 切換到 `OrderLineUserMap` 工作表
5. 從第 2 列開始貼上（第 1 列是標題）
6. 確認欄位對應正確

**範例資料**：
```
ES_Order_No    LINE_User_ID              Customer_Name    LINE_Display_Name
ES5336         U1234567890abcdefghij     王小明           小明
ES5401         U2345678901bcdefghijk     李大華           大華
ES5410         U3456789012cdefghijkl     張美玲           美玲
```

---

### 2. 採購商品資料（選填）

**來源表**：您現有的採購控制中心或訂單表

**目標表**：`Queue`

**欄位對照**：

| 現有欄位 | 新系統欄位 | 說明 |
|---------|-----------|------|
| 訂單編號 | ES_Order_No | 必填 |
| 商品名稱 | Product_Name | 必填 |
| SKU | SKU | 必填 |
| 顏色 | Color | 選填 |
| 尺寸 | Size | 選填 |
| 訂購數量 | Qty_Ordered | 必填 |
| 已分配數量 | Qty_Allocated | 選填（預設 0） |
| 採購狀態 | Purchase_Status | 選填（預設「待購買」） |
| 標價 | ListPrice | 選填 |
| 實際單價 | ActualPurchasePrice | 選填 |

**重要欄位說明**：

- `QueueID`：系統自動生成，匯入時留空即可
- `ExpectedShipMonth`：預計出貨月份（YYYY-MM）
- `ExpectedShipTen`：預計出貨旬（留空、上旬、中旬、下旬）
- `ExpectedShipLabel`：公式欄，自動計算，不需手動填寫
- `SelectedForBatch`：批次選取標記（預設 FALSE）
- `Batch_ID`：批次 ID（留空）
- `Box_ID`：箱號 ID（留空）
- `Tracking_JP_to_TW`：日本→台灣追蹤碼
- `Notify_Pushed_Flag`：通知推播標記（預設 FALSE）
- **`ReadyToNotify`**：確認推播標記（預設 FALSE）⭐ 新增欄位

**操作步驟**：

1. 準備 Excel 或 CSV 檔案，包含上述欄位
2. 開啟新系統的 Google Sheets
3. 切換到 `Queue` 工作表
4. 從第 2 列開始貼上
5. 確認公式欄（L 欄 ExpectedShipLabel）的公式仍然存在
6. 手動填寫 QueueID（建議使用 Q001, Q002, Q003...）

---

## 🔧 資料清理建議

### 匯入前檢查清單

- [ ] 確認所有訂單編號格式一致（例如：ES5336）
- [ ] 確認 LINE User ID 正確且有效（以 'U' 開頭）
- [ ] 移除重複的訂單與會員綁定資料
- [ ] 確認數量欄位為數字格式（不是文字）
- [ ] 確認日期格式為 YYYY-MM-DD

### 常見問題處理

**Q1：我的現有系統欄位名稱與新系統不同怎麼辦？**

A：您可以：
1. 在匯入前先調整欄位順序與名稱
2. 或使用 Google Sheets 的 `=IMPORTRANGE()` 函數自動對應

**Q2：我有很多歷史訂單，全部匯入嗎？**

A：建議：
- 只匯入「尚未完成」的訂單到 Queue 表
- 所有的「訂單與 LINE ID 對照」都要匯入到 OrderLineUserMap
- 已完成的訂單可以存檔備份，不需匯入

**Q3：匯入後需要手動調整什麼嗎？**

A：需要檢查：
- [ ] Queue 表的 L 欄（ExpectedShipLabel）公式是否正常
- [ ] 所有布林值欄位（SelectedForBatch, Notify_Pushed_Flag, ReadyToNotify）是否為 TRUE/FALSE
- [ ] 數量欄位是否為數字格式

---

## 📝 匯入範例

### 範例 1：最簡單的匯入（僅必要欄位）

**OrderLineUserMap**：
```csv
ES_Order_No,LINE_User_ID
ES5336,U1234567890abcdefghij
ES5401,U2345678901bcdefghijk
```

**Queue**：
```csv
QueueID,ES_Order_No,Product_Name,SKU,Qty_Ordered
Q001,ES5336,Nike T恤,NIKE-T01,2
Q002,ES5401,Adidas 運動褲,ADIDAS-P01,1
```

### 範例 2：完整匯入（包含所有欄位）

```csv
QueueID,ES_Order_No,Product_Name,SKU,Color,Size,Qty_Ordered,Qty_Allocated,Purchase_Status,ListPrice,ActualPurchasePrice,Tracking_JP_to_TW
Q001,ES5336,Nike T恤,NIKE-T01,白色,M,2,0,待購買,1500,,
Q002,ES5401,Adidas 運動褲,ADIDAS-P01,黑色,L,1,0,已購買,2000,1800,1234567890
```

---

## ⚠️ 重要注意事項

### 1. ReadyToNotify 欄位（新功能）

新系統新增了 **`ReadyToNotify`** 欄位用於推播確認機制：

- **預設值**：FALSE
- **用途**：只有當此欄位 = TRUE 時，系統才會推播 LINE 通知
- **匯入建議**：全部設為 FALSE，等您確認資料無誤後再手動勾選

### 2. 批次匯入後的驗證

匯入完成後，請執行以下檢查：

1. **測試 LINE 通知**：
   - 選擇一筆測試訂單
   - 填入追蹤碼
   - 將 `ReadyToNotify` 設為 TRUE
   - 確認是否收到 LINE 通知

2. **測試採購彙總**：
   - 開啟「採購彙總」頁面
   - 確認相同商品是否正確彙總

3. **測試批次匯出**：
   - 勾選幾個商品
   - 建立批次
   - 匯出 CSV
   - 確認「摘要」欄位顯示正確

---

## 🔄 從舊系統逐步遷移的建議流程

### 第 1 週：並行測試

1. ✅ 保留舊系統繼續運作
2. ✅ 新系統只匯入測試資料
3. ✅ 熟悉新系統的所有功能
4. ✅ 測試 LINE 推播機制

### 第 2 週：部分遷移

1. ✅ 匯入近期訂單（例如最近 30 天）
2. ✅ 匯入所有會員綁定資料
3. ✅ 新訂單開始在新系統中建立
4. ✅ 舊訂單仍在舊系統處理

### 第 3 週：完全遷移

1. ✅ 所有新訂單都在新系統處理
2. ✅ 舊訂單逐步在新系統中補完
3. ✅ 舊系統僅用於查詢歷史紀錄
4. ✅ 團隊完全熟悉新系統操作

### 第 4 週：舊系統退役

1. ✅ 備份舊系統所有資料
2. ✅ 將舊系統改為唯讀模式
3. ✅ 新系統成為唯一的操作系統

---

## 📞 需要協助？

如果匯入過程中遇到問題，請檢查：

1. 欄位名稱是否完全一致（大小寫敏感）
2. 資料格式是否正確（日期、數字、布林值）
3. 是否有空白列或多餘的空格
4. LINE User ID 是否有效

---

## 📋 匯入檢查清單

匯入完成後，請勾選以下項目：

- [ ] OrderLineUserMap 表已匯入所有訂單與 LINE ID 對照
- [ ] Queue 表已匯入需要處理的訂單
- [ ] 所有必要欄位都有值
- [ ] ExpectedShipLabel 公式正常運作
- [ ] 測試通知推播功能正常
- [ ] 測試採購彙總功能正常
- [ ] 測試批次匯出功能正常
- [ ] 團隊成員都了解新欄位（ReadyToNotify）的用途

---

**祝您匯入順利！** 🎉

如有任何問題，請隨時詢問。
